<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reliance Digital</title>
    <link rel="icon" type="image/x-icon" href="image/WhatsApp Image 2022-12-16 at 13.38.58.jpeg">
    <link rel="stylesheet" href="index.css">
    <style>
        #main_rendering_page {
            display: flex;
            margin-top: 2%;
            gap: 2%;
        }

        #filtering_div {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            grid-template-rows: auto;
            width: 25%;
            height: 500px;
            gap: 2%;
        }

        #filtering_div>div {
            box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
            background-color: white;
            padding-left: 5%;
            padding-top: 5%;
            padding-bottom: 5%;
        }

        #filtering_div>div>div {
            display: flex;

        }

        #filtering_div>div>div {
            width: 90%;
            margin: auto;
            align-items: center;
            margin-top: 2%;
        }

        #sort_and_render {
            width: 100%;
        }

        #sorting_div {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #sorting_div>div>button {
            padding: 5px 10px;
            border-radius: 6px;
            border: none;
            background-color: #F5F7F7;
            cursor: pointer;
        }

        #api_rendering_div {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto;
            gap: 2%;
            width: 100%;

        }

        #api_rendering_div>div {
            box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
            background-color: white;
            cursor: pointer;
            text-align: center;
            margin-top: 15%;

        }

        #api_rendering_div>div:hover {
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        }

        #api_rendering_div>div>img {
            width: 80%;
        }

        #api_rendering_div>div>img:hover {
            box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
            border-radius: 20px;
        }

        #api_rendering_div>div>p,
        #api_rendering_div>div>h4 {
            text-align: left;
            padding-left: 6%;
        }

        #api_rendering_div>div>p:nth-child(4) {
            font-size: 12px;
            border-color: #AACBA8;
            background-color: #EFFCF5;
            color: #61A061;
        }

        #api_rendering_div>div>button {
            width: 100%;
            height: 15%;
            background-color: #E42529;
            color: white;
            border: none;
            margin-top: 2%;
            cursor: pointer;
        }

        #api_rendering_div>div>button:hover {
            background-color: #ffffff;
            color: black;
            transition: 2ms;
        }
    </style>
</head>

<body>
    <div id="container">
        <div class="nav">
            <div id="logo"><img src="image\logo.jpg" alt=""></div>
            <div id="searchBar">
                <form>
                    <input type="text" placeholder="Find your favorite products" name="search" />

                    <button type="submit" class="submit">Search</button>
                </form>
            </div>

            <div class="restOption">
                <div>
                    <a href="#"> <img src="image\map.png" alt="location">Find a store</a>
                    <a href="buyingGuides.html">Buying guides</a>
                    <a href="contact.html">Contact us</a>
                </div>
                <div>
                    <a href="#">Select your PIN Code</a>
                    <a href="cart.html">
                        <div></div><img src="image\cart.png" alt="cart">Cart
                    </a>
                    <a href="login.html"><img src="image\account.png" alt="user">Login</a>
                </div>
            </div>
        </div>

        <!-- Rendering the API -->
        <div id="main_rendering_page">
            <div id="filtering_div">
                <div>
                    <h3>FILTERS</h3>
                </div>
                <!-- <div>
                    <h4>Price</h4>
                    <div>
                        <div class="limit_price">
                            <input type="text" id="minimum_price">
                            <label for="" placeholder="">Min.</label>
                        </div>
                        <span>to</span>
                        <div class="limit_price">
                            <input type="text" id="maximum_price">
                            <label for="" placeholder="">Max.</label>
                        </div>
                    </div>
                </div> -->
                <div>
                    <h4>Availability</h4>
                    <div>
                        <input type="checkbox" checked>
                        <p>Exclude out of Stock</p>
                    </div>
                </div>
                <div id="category">
                    <h4>Category</h4>
                    <div class="category">
                        <input type="checkbox">
                        <p>Laptop</p>
                    </div>
                    <div class="category">
                        <input type="checkbox">
                        <p>Mobile</p>
                    </div>
                    <div class="category">
                        <input type="checkbox">
                        <p>Tv</p>
                    </div>
                    <div class="category">
                        <input type="checkbox">
                        <p>Watch</p>
                    </div>
                    <div class="category">
                        <input type="checkbox">
                        <p>Camera</p>
                    </div>
                    <div class="category">
                        <input type="checkbox">
                        <p>Headphone</p>
                    </div>
                </div>
                <div id="brands">
                    <h4>Brand</h4>
                    <div style="display: block;">
                        <!-- <div style="display: flex;">
                            <input type="checkbox">
                            <p>Fire-Bolt</p>
                        </div>
                        <div>
                            <input type="checkbox">
                            <p>boAt</p>
                        </div>
                        <div>
                            <input type="checkbox">
                            <p>boAt</p>
                        </div> -->
                    </div>
                </div>
            </div>
            <div id="sort_and_render">
                <div id="sorting_div">
                    <div>
                        <h1>Latest <span>Laptop</span>'s :-</h1>
                    </div>
                    <div>
                        <label for="">Sort By:</label>
                        <button id="LTH">Price(Low-High)</button>
                        <button id="HTL">Price(High-Low)</button>
                    </div>
                </div>
                <div id="api_rendering_div">
                    <!-- Render your Api hear -->
                    <!-- <div>
                        <img src="" alt="">
                        <p></p>
                        <h4>&#8377;</h4>
                        <button>OFFERS Available</button>
                        <button>Add To Cart</button>
                    </div> -->
                </div>
            </div>

        </div>
    </div>

</body>

</html>
<script>
    // Fetching All data.......
    async function FetchedAllData() {
        try {
            let api_data = await fetch("https://63996f3916b0fdad773c979e.mockapi.io/products", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
            let data = await api_data.json();
            filterByCategory(data);
        } catch (error) {
            alert("something went wrong.")
        }
    }
    FetchedAllData();

    // selecting category type data and filtering...
    let checked_category = "Mobile";
    let category_checkbox = document.querySelectorAll("#category>div>p");
    let data_according_category = [];
    let bag = ""
    for (let i = 0; i <= category_checkbox.length - 1; i++) {
        if (checked_category === category_checkbox[i].innerText) {
            let commit_change = document.querySelector(`#category>div:nth-child(${i + 2})`);
            commit_change.innerHTML = `
                <div class="category" style= "display:flex">
                    <input type="checkbox" checked>
                    <p>${checked_category}</p>
                </div>
            `
        }
    }

    function filterByCategory(data) {
        let selected = checked_category;
        let filteredData = data.filter(function (element) {
            return element.category == selected;
        });
        data_according_category = filteredData;
        brand(data_according_category);
        displayCards(filteredData);
    }

    // fetching Brands...
    let brands = [];
    function brand(data_according_category) {
        let arr = [];
        for (let i = 0; i <= data_according_category.length - 1; i++) {
            if (arr.length === 0) {
                arr.push(data_according_category[i].brand);
            } else if (arr[arr.length - 1] === data_according_category[i].brand) {
                continue;
            } else {
                arr.push(data_according_category[i].brand);
            }
        }
        display_brands(arr);
    }
    function display_brands(arr) {
        document.querySelector("#brands>div").innerHTML = ""
        document.querySelector("#brands>div").innerHTML = arr.map(element => {
            return `
            <div style="display: flex;">
                <input type="checkbox" id="checked">
                <p>${element}</p>
            </div>
            `
        }).join(" ");
        // filter data by brands...
        let all_brands_ckeckboxes = document.querySelectorAll("#checked")
        for (let btn_check of all_brands_ckeckboxes) {
            btn_check.addEventListener("change", (event) => {
                let filter_by_this = event.target.parentElement.children[1].innerText;
                filter_by_brands(filter_by_this)
            });
        }
    }

    //filter data by brands...
    let filteredData_by_brand = [];
    function filter_by_brands(filter_by_this) {
        console.log(filter_by_this)
        let selected = filter_by_this;
        filteredData_int = data_according_category.filter(function (element) {
            return element.brand == selected;
        });
        filteredData_int.map((element) => {
            filteredData_by_brand.push(element);
        });
        displayCards(filteredData_by_brand);
        bag = filteredData_by_brand;
    }



    // display all our data...
    let cartItems = JSON.parse(localStorage.getItem("apan_e-store_cartproduct")) || [];
    function displayCards(data) {
        let container = document.querySelector("#api_rendering_div");
        container.innerHTML = "";
        data.forEach(element => {
            let div = document.createElement("div");
            div.addEventListener("click", function () {
                localStorage.setItem("product_details", JSON.stringify(element))
            });

            let img = document.createElement("img");
            img.setAttribute("src", element.avatar);
            let discription = document.createElement("p");
            let str = element.discription
            discription.innerText = `${str.substring(0, 50)}...`;
            let price = document.createElement("h4");
            price.innerHTML = `<h4>&#8377; ${element.price}</h4>`;
            let offer = document.createElement("p");
            offer.innerText = "OFFER AVAILABLE";
            let cart_btn = document.createElement("button");
            cart_btn.innerText = "Add To Cart";
            cart_btn.addEventListener("click", function () {
                if (cartItems.includes(element)) {
                    alert("Already Existing Item in Cart")
                } else {
                    cartItems.push(element);
                    localStorage.setItem("apan_e-store_cartproduct", JSON.stringify(cartItems));
                }

            })
            div.append(img, discription, price, offer, cart_btn);
            document.querySelector("#api_rendering_div").append(div);
        });
    }



    // sort the displayed data...
    let lth_btn = document.querySelector("#LTH")
    lth_btn.addEventListener("click", sort_price_by_LTH)
    function sort_price_by_LTH() {
        let selected = document.querySelector("#LTH").id;
        if (bag === "") {
            let sortedData = data_according_category.sort((a, b) => a.price - b.price);
            displayCards(sortedData);
        } else if (bag !== []) {
            let sortedData = bag.sort((a, b) => a.price - b.price);
            displayCards(sortedData);
        }
    }

    let htl_btn = document.querySelector("#HTL")
    htl_btn.addEventListener("click", sort_price_by_HTL)
    function sort_price_by_HTL() {
        let selected = document.querySelector("#HTL").id;
        if (bag === "") {
            let sortedData = data_according_category.sort((a, b) => b.price - a.price);
            displayCards(sortedData);
        } else if (bag !== []) {
            let sortedData = bag.sort((a, b) => b.price - a.price);
            displayCards(sortedData);
        }
    }

</script>